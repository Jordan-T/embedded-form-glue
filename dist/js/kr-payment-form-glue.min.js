(()=>{"use strict";const t=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150,i=function i(){t[e]?n():setTimeout(i,o)};setTimeout(i,0)};function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const n=new(function(){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),n.instance?n.instance:(n.instance=this,this._name="Krypton Glue",this.configuration={},this.domain=null,this.formToken=null,this.publicKey=null,this.loaded=!1,this.loading=!1,this)}var o,i;return o=n,i=[{key:"loadLibrary",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=/^\d{2,8}:(|test)publickey_.+$/g;if(this.loaded)return this.getKrypton(e);if(!t)return Promise.reject("Domain not defined");if(!e)return Promise.reject("Public key not defined");try{var i=new URL(t);if(!["http:","https:"].includes(i.protocol))throw new Error("Invalid protocol");if(i.port)throw new Error("No port allowed");if(""!==i.search)throw new Error("No query params allowed");if("/"!==i.pathname)throw new Error("Invalid path")}catch(e){return console.error("Domain format should be https://domain.name"),Promise.reject("[".concat(t,"] is not a valid endpoint domain"))}return o.test(e)?(this.domain=t,this.publicKey=e,this.formToken=n,this.domain&&this.publicKey?this.loadKryptonClient():Promise.reject("The library cannot be loaded")):(console.error("Public key format should be shopId:[test]publickey_*"),Promise.reject("[".concat(e,"] is not a valid public key")))}},{key:"loadKryptonClient",value:function(){var e=this;if(!this.loading){var n=this.publicKey,o=this.domain;this.loading=!0;var i=document.createElement("script");i.type="text/javascript",/^.+\/$/.test(o)||(o+="/"),i.src="".concat(o,"static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"),i.setAttribute("kr-public-key",n),i.setAttribute("kr-spa-mode","true"),this.formToken&&i.setAttribute("kr-form-token",this.formToken),!document.querySelector('script[src="'.concat(i.src,'"]'))&&document.body?document.body.appendChild(i):document.body||console.warn("document.body is undefined")}return new Promise((function(n){t(window,"KR",(function(){t(window.KR,"ready",(function(){e.loaded=!0,e.loading=!1,n({KR:window.KR})}))}))}))}},{key:"getKrypton",value:function(t){var e=this;return new Promise((function(n,o){t&&t!==e.publicKey?window.KR.setFormConfig({publicKey:t}).then(n).catch(o):n({KR:window.KR})}))}}],i&&e(o.prototype,i),Object.defineProperty(o,"prototype",{writable:!1}),n}());"undefined"!=typeof window&&(window.KRGlue||(window.KRGlue=n))})();
//# sourceMappingURL=kr-payment-form-glue.min.js.map