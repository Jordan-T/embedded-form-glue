var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function a(t){t.parentNode&&t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function c(t){return document.createTextNode(t)}function l(){return c(" ")}function f(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}let d;function h(t){d=t}function p(t){(function(){if(!d)throw new Error("Function called outside component initialization");return d})().$$.on_mount.push(t)}const m=[],y=[];let v=[];const _=[],b=Promise.resolve();let g=!1;function w(t){v.push(t)}const $=new Set;let k=0;function P(){if(0!==k)return;const t=d;do{try{for(;k<m.length;){const t=m[k];k++,h(t),j(t.$$)}}catch(t){throw m.length=0,k=0,t}for(h(null),m.length=0,k=0;y.length;)y.pop()();for(let t=0;t<v.length;t+=1){const e=v[t];$.has(e)||($.add(e),e())}v.length=0}while(m.length);for(;_.length;)_.pop()();g=!1,$.clear(),h(t)}function j(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const E=new Set;function A(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];v.forEach((r=>-1===t.indexOf(r)?e.push(r):n.push(r))),n.forEach((t=>t())),v=e}(n.after_update),r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function T(t,e){-1===t.$$.dirty[0]&&(m.push(t),g||(g=!0,b.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function x(i,s,u,c,l,f,p,m=[-1]){const y=d;h(i);const v=i.$$={fragment:null,ctx:[],props:f,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(s.context||(y?y.$$.context:[])),callbacks:n(),dirty:m,skip_bound:!1,root:s.target||y.$$.root};p&&p(v.root);let _=!1;if(v.ctx=u?u(i,s.props||{},((t,e,...n)=>{const r=n.length?n[0]:e;return v.ctx&&l(v.ctx[t],v.ctx[t]=r)&&(!v.skip_bound&&v.bound[t]&&v.bound[t](r),_&&T(i,t)),e})):[],v.update(),_=!0,r(v.before_update),v.fragment=!!c&&c(v.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);v.fragment&&v.fragment.l(t),t.forEach(a)}else v.fragment&&v.fragment.c();s.intro&&((b=i.$$.fragment)&&b.i&&(E.delete(b),b.i(g))),function(t,n,i,s){const{fragment:a,after_update:u}=t.$$;a&&a.m(n,i),s||w((()=>{const n=t.$$.on_mount.map(e).filter(o);t.$$.on_destroy?t.$$.on_destroy.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(w)}(i,s.target,s.anchor,s.customElement),P()}var b,g;h(y)}class O{$destroy(){A(this,1),this.$destroy=t}$on(e,n){if(!o(n))return t;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function C(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var S={},M={};var N={};({get exports(){return N},set exports(t){N=t}}).exports=function(){function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function e(t){return"function"==typeof t}var n=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},r=0,o=void 0,i=void 0,s=function(t,e){b[r]=t,b[r+1]=e,2===(r+=2)&&(i?i(g):$())};function a(t){i=t}function u(t){s=t}var c="undefined"!=typeof window?window:void 0,l=c||{},f=l.MutationObserver||l.WebKitMutationObserver,d="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){return function(){return process.nextTick(g)}}function m(){return void 0!==o?function(){o(g)}:_()}function y(){var t=0,e=new f(g),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function v(){var t=new MessageChannel;return t.port1.onmessage=g,function(){return t.port2.postMessage(0)}}function _(){var t=setTimeout;return function(){return t(g,1)}}var b=new Array(1e3);function g(){for(var t=0;t<r;t+=2)(0,b[t])(b[t+1]),b[t]=void 0,b[t+1]=void 0;r=0}function w(){try{var t=Function("return this")().require("vertx");return o=t.runOnLoop||t.runOnContext,m()}catch(t){return _()}}var $=void 0;function k(t,e){var n=this,r=new this.constructor(E);void 0===r[j]&&J(r);var o=n._state;if(o){var i=arguments[o-1];s((function(){return q(o,r,i,n._result)}))}else U(n,r,t,e);return r}function P(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(E);return R(n,t),n}$=d?p():f?y():h?v():void 0===c?w():_();var j=Math.random().toString(36).substring(2);function E(){}var A=void 0,T=1,x=2;function O(){return new TypeError("You cannot resolve a promise with itself")}function C(){return new TypeError("A promises callback cannot return that same promise.")}function S(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function M(t,e,n){s((function(t){var r=!1,o=S(n,e,(function(n){r||(r=!0,e!==n?R(t,n):L(t,n))}),(function(e){r||(r=!0,I(t,e))}),"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,I(t,o))}),t)}function N(t,e){e._state===T?L(t,e._result):e._state===x?I(t,e._result):U(e,void 0,(function(e){return R(t,e)}),(function(e){return I(t,e)}))}function F(t,n,r){n.constructor===t.constructor&&r===k&&n.constructor.resolve===P?N(t,n):void 0===r?L(t,n):e(r)?M(t,n,r):L(t,n)}function R(e,n){if(e===n)I(e,O());else if(t(n)){var r=void 0;try{r=n.then}catch(t){return void I(e,t)}F(e,n,r)}else L(e,n)}function D(t){t._onerror&&t._onerror(t._result),Y(t)}function L(t,e){t._state===A&&(t._result=e,t._state=T,0!==t._subscribers.length&&s(Y,t))}function I(t,e){t._state===A&&(t._state=x,t._result=e,s(D,t))}function U(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+T]=n,o[i+x]=r,0===i&&t._state&&s(Y,t)}function Y(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?q(n,r,o,i):o(i);t._subscribers.length=0}}function q(t,n,r,o){var i=e(r),s=void 0,a=void 0,u=!0;if(i){try{s=r(o)}catch(t){u=!1,a=t}if(n===s)return void I(n,C())}else s=o;n._state!==A||(i&&u?R(n,s):!1===u?I(n,a):t===T?L(n,s):t===x&&I(n,s))}function B(t,e){try{e((function(e){R(t,e)}),(function(e){I(t,e)}))}catch(e){I(t,e)}}var G=0;function H(){return G++}function J(t){t[j]=G++,t._state=void 0,t._result=void 0,t._subscribers=[]}function z(){return new Error("Array Methods must be provided an Array")}var V=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(E),this.promise[j]||J(this.promise),n(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&L(this.promise,this._result))):I(this.promise,z())}return t.prototype._enumerate=function(t){for(var e=0;this._state===A&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===P){var o=void 0,i=void 0,s=!1;try{o=t.then}catch(t){s=!0,i=t}if(o===k&&t._state!==A)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===et){var a=new n(E);s?I(a,i):F(a,t,o),this._willSettleAt(a,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===A&&(this._remaining--,t===x?I(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;U(t,void 0,(function(t){return n._settledAt(T,e,t)}),(function(t){return n._settledAt(x,e,t)}))},t}();function W(t){return new V(this,t).promise}function Q(t){var e=this;return n(t)?new e((function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)})):new e((function(t,e){return e(new TypeError("You must pass an array to race."))}))}function X(t){var e=new this(E);return I(e,t),e}function Z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function tt(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var et=function(){function t(e){this[j]=H(),this._result=this._state=void 0,this._subscribers=[],E!==e&&("function"!=typeof e&&Z(),this instanceof t?B(this,e):tt())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var n=this,r=n.constructor;return e(t)?n.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))})):n.then(t,t)},t}();function nt(){var t=void 0;if(void 0!==K)t=K;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=et}return et.prototype.then=k,et.all=W,et.race=Q,et.resolve=P,et.reject=X,et._setScheduler=a,et._setAsap=u,et._asap=s,et.polyfill=nt,et.Promise=et,et}(),N.polyfill();var F={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150;setTimeout((function o(){t[e]?n():setTimeout(o,r)}),0)}}(F),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e,n=(e=F)&&e.__esModule?e:{default:e};function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.instance?t.instance:(t.instance=this,this._name="Krypton Glue",this.configuration={},this.domain=null,this.formToken=null,this.publicKey=null,this.loaded=!1,this.loading=!1,this)}var e,o,i;return e=t,o=[{key:"loadLibrary",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.loaded?this.getKrypton(e):t?e?/^(?:http(s)?:\/\/)[\w.-]+(?:\.[\w.-]+)+[\w\-._~:/?#[\]@!$&'()*+,;=.]+$/g.test(t)?/^\d{2,8}:(|test)publickey_.+$/g.test(e)?(this.domain=t,this.publicKey=e,this.formToken=n,this.domain&&this.publicKey?this.loadKryptonClient():Promise.reject("The library cannot be loaded")):(console.error("Public key format should be shopId:[test]publickey_*"),Promise.reject("[".concat(e,"] is not a valid public key"))):(console.error("Domain format should be https://domain.name"),Promise.reject("[".concat(t,"] is not a valid endpoint domain"))):Promise.reject("Public key not defined"):Promise.reject("Domain not defined")}},{key:"loadKryptonClient",value:function(){var t=this;if(!this.loading){var e=this.publicKey,r=this.domain;this.loading=!0;var o=document.createElement("script");o.type="text/javascript",/^.+\/$/.test(r)||(r+="/"),o.src="".concat(r,"static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"),o.setAttribute("kr-public-key",e),o.setAttribute("kr-spa-mode","true"),this.formToken&&o.setAttribute("kr-form-token",this.formToken),!document.querySelector('script[src="'.concat(o.src,'"]'))&&document.body?document.body.appendChild(o):document.body||console.warn("document.body is undefined")}return new Promise((function(e){(0,n.default)(window,"KR",(function(){(0,n.default)(window.KR,"ready",(function(){t.loaded=!0,t.loading=!1,e({KR:window.KR})}))}))}))}},{key:"getKrypton",value:function(t){var e=this;return new Promise((function(n,r){t&&t!==e.publicKey?window.KR.setFormConfig({publicKey:t}).then(n).catch(r):n({KR:window.KR})}))}}],o&&r(e.prototype,o),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),i=new o;t.default=i}(M),function(t){var e;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=((e=M)&&e.__esModule?e:{default:e}).default;t.default=n}(S);var R=C(S);function D(e){let n,r,o,i,d,h,p,m;return{c(){n=u("main"),r=u("div"),o=u("h1"),o.textContent="Svelte + KR.attachForm",i=l(),d=u("div"),d.innerHTML='<div class="kr-smart-form" kr-card-form-expanded=""></div>',h=l(),p=u("div"),m=c(e[0]),f(o,"class","svelte-1jpaokv"),f(d,"class","form-container"),f(d,"id","myPaymentForm"),f(p,"class","message"),f(p,"data-test","payment-message"),f(r,"class","container svelte-1jpaokv")},m(t,e){!function(t,e,n){t.insertBefore(e,n||null)}(t,n,e),s(n,r),s(r,o),s(r,i),s(r,d),s(r,h),s(r,p),s(p,m)},p(t,[e]){1&e&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(m,t[0])},i:t,o:t,d(t){t&&a(n)}}}function L(t,e,n){let r="";p((async()=>{let t="DEMO-TOKEN-TO-BE-REPLACED";try{const e=await fetch("http://localhost:3000/createPayment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentConf:{amount:1e4,currency:"USD"}})});t=await e.text();const{KR:n}=await R.loadLibrary("~~CHANGE_ME_ENDPOINT~~","~~CHANGE_ME_PUBLIC_KEY~~");await n.setFormConfig({formToken:t,"kr-language":"en-US"}),await n.onSubmit(o);const{result:r}=await n.attachForm("#myPaymentForm");await n.showForm(r.formId)}catch(t){n(0,r=t+" (see console for more details)")}}));const o=async t=>(200===(await fetch("http://localhost:3000/validatePayment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).status&&n(0,r="Payment successful!"),!1);return[r]}return new class extends O{constructor(t){super(),x(this,t,L,D,i,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
